<!DOCTYPE html>
<!-- saved from url=(0035)http://bl.ocks.org/mbostock/4712128 -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="viewport" content="width=1000">
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@mbostock">
<meta property="og:url" content="http://bl.ocks.org/mbostock/4712128">
<meta property="og:title" content="The Sun’s View of the Earth">
<meta property="og:description" content="Mike Bostock’s Block 4712128">
<meta property="og:image" content="http://bl.ocks.org/mbostock/raw/4712128/61719d34be820257981da516b5c00515935b405d/thumbnail.png">
<title>The Sun’s View of the Earth - bl.ocks.org</title>
<link rel="icon" href="http://bl.ocks.org/favicon.png">
<style>

@import url("/style.css");

</style>

</head><body><header>
  <div class="column">
    <div class="navigation">
      <a href="http://bl.ocks.org/">Popular</a>
      / <a href="http://bl.ocks.org/-/about">About</a>
    </div>
    <a class="user" href="http://bl.ocks.org/mbostock"><img class="avatar" src="./The Sun’s View of the Earth - bl.ocks.org_files/230541" width="30" height="30">Mike Bostock</a>’s
    Block <a class="gist gist-id self" title="View Gist on GitHub." href="https://gist.github.com/mbostock/4712128">4712128</a>
    ← <a class="gist-id" href="http://bl.ocks.org/mbostock/4597134">4597134</a>    <div class="date">Updated February 8, 2016</div>
  </div>
</header>

<div class="column">
  <h1>The Sun’s View of the Earth</h1>
  <div class="index">
    <iframe sandbox="allow-popups allow-scripts allow-forms allow-same-origin" src="./The Sun’s View of the Earth - bl.ocks.org_files/saved_resource.html" marginwidth="0" marginheight="0" style="height: 960px;" scrolling="no"></iframe>
  </div>
  <div class="index-pop">
    <a target="_blank" title="Open Block 4712128 a new window." href="http://bl.ocks.org/mbostock/raw/4712128">Open<svg height="16" width="12"><path d="M11 10h1v3c0 0.55-0.45 1-1 1H1c-0.55 0-1-0.45-1-1V3c0-0.55 0.45-1 1-1h3v1H1v10h10V10zM6 2l2.25 2.25-3.25 3.25 1.5 1.5 3.25-3.25 2.25 2.25V2H6z"></path></svg></a>
  </div>
  <div class="gist-readme" data-key="README.md"><p>An alternate view of the <a href="http://bl.ocks.org/4597134">solar terminator</a>.</p></div>
  <div class="gist-sources">
    <div class="gist-source" data-key="index.html">
      <h2>index.html<a name="index.html" class="anchor" href="http://bl.ocks.org/mbostock/4712128#index.html">#</a></h2>
      <pre><code class="html xml"><span class="doctype">&lt;!DOCTYPE html&gt;</span>
<span class="tag">&lt;<span class="title">meta</span> <span class="attribute">charset</span>=<span class="value">"utf-8"</span>&gt;</span>
<span class="tag">&lt;<span class="title">style</span>&gt;</span><span class="css">

<span class="tag">body</span> <span class="rules">{
  <span class="rule"><span class="attribute">background</span>:<span class="value"> <span class="hexcolor">#fcfcfa</span></span>;</span>
<span class="rule">}</span></span>

<span class="class">.sun</span> <span class="rules">{
  <span class="rule"><span class="attribute">fill</span>:<span class="value"> red</span>;</span>
<span class="rule">}</span></span>

<span class="class">.stroke</span> <span class="rules">{
  <span class="rule"><span class="attribute">fill</span>:<span class="value"> <span class="hexcolor">#fff</span></span>;</span>
  <span class="rule"><span class="attribute">stroke</span>:<span class="value"> <span class="number">#000</span></span>;</span>
  <span class="rule"><span class="attribute">stroke-width</span>:<span class="value"> <span class="number">1.5</span>px</span>;</span>
<span class="rule">}</span></span>

<span class="class">.land</span> <span class="rules">{
  <span class="rule"><span class="attribute">fill</span>:<span class="value"> <span class="number">#222</span></span>;</span>
<span class="rule">}</span></span>

</span><span class="tag">&lt;/<span class="title">style</span>&gt;</span>
<span class="tag">&lt;<span class="title">body</span>&gt;</span>
<span class="tag">&lt;<span class="title">script</span> <span class="attribute">src</span>=<span class="value">"//d3js.org/d3.v3.min.js"</span>&gt;</span><span class="javascript"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>
<span class="tag">&lt;<span class="title">script</span> <span class="attribute">src</span>=<span class="value">"//d3js.org/topojson.v1.min.js"</span>&gt;</span><span class="javascript"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>
<span class="tag">&lt;<span class="title">script</span>&gt;</span><span class="javascript">

<span class="keyword">var</span> width = <span class="number">960</span>,
    height = <span class="number">960</span>;

<span class="keyword">var</span> π = Math.PI,
    radians = π / <span class="number">180</span>,
    degrees = <span class="number">180</span> / π;

<span class="keyword">var</span> projection = d3.geo.orthographic()
    .clipAngle(<span class="number">90</span>)
    .scale(<span class="number">475</span>)
    .translate([width / <span class="number">2</span>, height / <span class="number">2</span>])
    .precision(.<span class="number">1</span>);

<span class="keyword">var</span> path = d3.geo.path()
    .projection(projection);

<span class="keyword">var</span> svg = d3.select(<span class="string">"body"</span>).append(<span class="string">"svg"</span>)
    .attr(<span class="string">"width"</span>, width)
    .attr(<span class="string">"height"</span>, height);

svg.append(<span class="string">"circle"</span>)
    .attr(<span class="string">"class"</span>, <span class="string">"stroke"</span>)
    .attr(<span class="string">"transform"</span>, <span class="string">"translate("</span> + width / <span class="number">2</span> + <span class="string">","</span> + height / <span class="number">2</span> + <span class="string">")"</span>)
    .attr(<span class="string">"r"</span>, projection.scale());

svg.append(<span class="string">"circle"</span>)
    .attr(<span class="string">"class"</span>, <span class="string">"sun"</span>)
    .attr(<span class="string">"transform"</span>, <span class="string">"translate("</span> + width / <span class="number">2</span> + <span class="string">","</span> + height / <span class="number">2</span> + <span class="string">")"</span>)
    .attr(<span class="string">"r"</span>, <span class="number">2.5</span>);

d3.json(<span class="string">"/mbostock/raw/4090846/world-50m.json"</span>, <span class="function"><span class="keyword">function</span><span class="params">(error, world)</span> {</span>
  <span class="keyword">if</span> (error) <span class="keyword">throw</span> error;

  <span class="keyword">var</span> land = svg.insert(<span class="string">"path"</span>, <span class="string">".sun"</span>)
      .datum(topojson.feature(world, world.objects.land))
      .attr(<span class="string">"class"</span>, <span class="string">"land"</span>)
      .attr(<span class="string">"d"</span>, path);

  redraw();
  setInterval(redraw, <span class="number">1000</span>);

  <span class="function"><span class="keyword">function</span> <span class="title">redraw</span><span class="params">()</span> {</span>
    <span class="keyword">var</span> position = solarPosition(<span class="keyword">new</span> Date);
    projection.rotate([-position[<span class="number">0</span>], -position[<span class="number">1</span>]]);
    land.attr(<span class="string">"d"</span>, path);
  }
});

<span class="function"><span class="keyword">function</span> <span class="title">solarPosition</span><span class="params">(time)</span> {</span>
  <span class="keyword">var</span> centuries = (time - Date.UTC(<span class="number">2000</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">12</span>)) / <span class="number">864</span>e5 / <span class="number">36525</span>, <span class="comment">// since J2000</span>
      longitude = (d3.time.day.utc.floor(time) - time) / <span class="number">864</span>e5 * <span class="number">360</span> - <span class="number">180</span>;
  <span class="keyword">return</span> [
    longitude - equationOfTime(centuries) * degrees,
    solarDeclination(centuries) * degrees
  ];
}

<span class="comment">// Equations based on NOAA’s Solar Calculator; all angles in radians.</span>
<span class="comment">// http://www.esrl.noaa.gov/gmd/grad/solcalc/</span>

<span class="function"><span class="keyword">function</span> <span class="title">equationOfTime</span><span class="params">(centuries)</span> {</span>
  <span class="keyword">var</span> e = eccentricityEarthOrbit(centuries),
      m = solarGeometricMeanAnomaly(centuries),
      l = solarGeometricMeanLongitude(centuries),
      y = Math.tan(obliquityCorrection(centuries) / <span class="number">2</span>);
  y *= y;
  <span class="keyword">return</span> y * Math.sin(<span class="number">2</span> * l)
      - <span class="number">2</span> * e * Math.sin(m)
      + <span class="number">4</span> * e * y * Math.sin(m) * Math.cos(<span class="number">2</span> * l)
      - <span class="number">0.5</span> * y * y * Math.sin(<span class="number">4</span> * l)
      - <span class="number">1.25</span> * e * e * Math.sin(<span class="number">2</span> * m);
}

<span class="function"><span class="keyword">function</span> <span class="title">solarDeclination</span><span class="params">(centuries)</span> {</span>
  <span class="keyword">return</span> Math.asin(Math.sin(obliquityCorrection(centuries)) * Math.sin(solarApparentLongitude(centuries)));
}

<span class="function"><span class="keyword">function</span> <span class="title">solarApparentLongitude</span><span class="params">(centuries)</span> {</span>
  <span class="keyword">return</span> solarTrueLongitude(centuries) - (<span class="number">0.00569</span> + <span class="number">0.00478</span> * Math.sin((<span class="number">125.04</span> - <span class="number">1934.136</span> * centuries) * radians)) * radians;
}

<span class="function"><span class="keyword">function</span> <span class="title">solarTrueLongitude</span><span class="params">(centuries)</span> {</span>
  <span class="keyword">return</span> solarGeometricMeanLongitude(centuries) + solarEquationOfCenter(centuries);
}

<span class="function"><span class="keyword">function</span> <span class="title">solarGeometricMeanAnomaly</span><span class="params">(centuries)</span> {</span>
  <span class="keyword">return</span> (<span class="number">357.52911</span> + centuries * (<span class="number">35999.05029</span> - <span class="number">0.0001537</span> * centuries)) * radians;
}

<span class="function"><span class="keyword">function</span> <span class="title">solarGeometricMeanLongitude</span><span class="params">(centuries)</span> {</span>
  <span class="keyword">var</span> l = (<span class="number">280.46646</span> + centuries * (<span class="number">36000.76983</span> + centuries * <span class="number">0.0003032</span>)) % <span class="number">360</span>;
  <span class="keyword">return</span> (l &lt; <span class="number">0</span> ? l + <span class="number">360</span> : l) / <span class="number">180</span> * π;
}

<span class="function"><span class="keyword">function</span> <span class="title">solarEquationOfCenter</span><span class="params">(centuries)</span> {</span>
  <span class="keyword">var</span> m = solarGeometricMeanAnomaly(centuries);
  <span class="keyword">return</span> (Math.sin(m) * (<span class="number">1.914602</span> - centuries * (<span class="number">0.004817</span> + <span class="number">0.000014</span> * centuries))
      + Math.sin(m + m) * (<span class="number">0.019993</span> - <span class="number">0.000101</span> * centuries)
      + Math.sin(m + m + m) * <span class="number">0.000289</span>) * radians;
}

<span class="function"><span class="keyword">function</span> <span class="title">obliquityCorrection</span><span class="params">(centuries)</span> {</span>
  <span class="keyword">return</span> meanObliquityOfEcliptic(centuries) + <span class="number">0.00256</span> * Math.cos((<span class="number">125.04</span> - <span class="number">1934.136</span> * centuries) * radians) * radians;
}

<span class="function"><span class="keyword">function</span> <span class="title">meanObliquityOfEcliptic</span><span class="params">(centuries)</span> {</span>
  <span class="keyword">return</span> (<span class="number">23</span> + (<span class="number">26</span> + (<span class="number">21.448</span> - centuries * (<span class="number">46.8150</span> + centuries * (<span class="number">0.00059</span> - centuries * <span class="number">0.001813</span>))) / <span class="number">60</span>) / <span class="number">60</span>) * radians;
}

<span class="function"><span class="keyword">function</span> <span class="title">eccentricityEarthOrbit</span><span class="params">(centuries)</span> {</span>
  <span class="keyword">return</span> <span class="number">0.016708634</span> - centuries * (<span class="number">0.000042037</span> + <span class="number">0.0000001267</span> * centuries);
}

d3.select(self.frameElement).style(<span class="string">"height"</span>, height + <span class="string">"px"</span>);

</span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>
</code></pre>
    </div>
  </div>
  <div class="gist-license">
    <h2>LICENSE<a name="license" class="anchor" href="http://bl.ocks.org/mbostock/4712128#license">#</a></h2>
    Released under the <a target="_blank" href="https://opensource.org/licenses/GPL-3.0">GNU General Public License, version 3</a>.
  </div>
</div>

<script src="./The Sun’s View of the Earth - bl.ocks.org_files/d3.v3.min.js.download"></script>
<script src="./The Sun’s View of the Earth - bl.ocks.org_files/highlight.min.js.download"></script>
<script>

var gist = {"public":true,"protocol":"http","sha":"61719d34be820257981da516b5c00515935b405d","files":{".block":{"language":null,"type":"text/plain","filename":".block","size":17,"sha":"703d310b399098a243a76a50bc209167e924cfd2"},"README.md":{"language":"Markdown","type":"text/plain","filename":"README.md","size":55,"sha":"88c0e91451de2a69edebc4e44544dce37f0b387c"},"index.html":{"language":"HTML","type":"text/html","filename":"index.html","size":3911,"sha":"1acb01233b5c39aeb722e27df360783a552a0f4b"},"thumbnail.png":{"language":null,"type":"image/png","filename":"thumbnail.png","size":14848,"sha":"5c174a4895594ce040d2986940174de6fb5fee01"}},"created_at":"2013-02-05T04:17:40Z","updated_at":"2016-02-09T02:08:27Z","description":"The Sun’s View of the Earth","owner":{"login":"mbostock"},"fork_of":{"id":"4597134","owner":{"login":"mbostock"}},"id":"4712128"};

var files = d3.values(gist.files);

d3.select(".gist-readme")
    .data(files, function(d) { return d ? d.filename : this.getAttribute("data-key"); })
    .each(function(d) {
      var readme = d3.select(this);
      d3.text("/mbostock/raw/4712128/61719d34be820257981da516b5c00515935b405d/" + d.filename, function(error, content) {
        if (error) content = "Sorry, an error occurred.";
        readme.html(new Showdown.converter().makeHtml(content));
        readme.selectAll("code").each(function() { hljs.highlightBlock(this); });
      });
    });

d3.selectAll(".gist-source")
    .data(files, function(d) { return d ? d.filename : this.getAttribute("data-key"); })
  .select("code")
    .attr("class", function(d) { return d.language && (d.language === "JSON" ? "javascript" : d.language.toLowerCase()); })
    .each(function(d) {
      var code = d3.select(this);
      d3.text("/mbostock/raw/4712128/61719d34be820257981da516b5c00515935b405d/" + (d.filename === "index.html" ? "" : d.filename), function(error, content) {
        if (error) content = "Sorry, an error occurred.";
        code.text(content);
        hljs.highlightBlock(code.node());
      });
    });

</script>

<script>

GoogleAnalyticsObject = "ga", ga = function() { ga.q.push(arguments); }, ga.q = [], ga.l = +new Date;
ga("create", "UA-48272912-1", "auto");
ga("send", "pageview");

</script>
<script async="" src="./The Sun’s View of the Earth - bl.ocks.org_files/analytics.js.download"></script>
</body></html>